#!/usr/bin/env node

// Generates Markdown-formatted API documentation from module/command help functions.

import { compileHelp } from '../modules/cli.js';
import * as utils from '../modules/utils.js';

utils.findConfig(() => {
  utils.CONFIG_DIR = '/path/to/.overcast';
  utils.CLUSTERS_JSON = utils.CONFIG_DIR + '/clusters.json';
  utils.VARIABLES_JSON = utils.CONFIG_DIR + '/variables.json';

  utils.eachObject(utils.getCommands(), (command, name) => {
    if (command.help) {
      // Old syntax <= 0.6.1
      console.log('### overcast ' + name);
      console.log('');
      console.log('```');
      command.help();
      console.log('```');
      console.log('');
    } else if (command.commands) {
      // New syntax > 0.6.1
      command.commands.forEach((subcommand) => {
        if (subcommand.alias === true) {
          return;
        }
        var subcommandName = subcommand.name && name !== subcommand.name ?
          ' ' + subcommand.name : '';
        console.log('### overcast ' + name + subcommandName);
        console.log('');
        console.log('```');
        compileHelp(subcommand, true);
        console.log('```');
        console.log('');
      });
    }
  });
});
